# è‰ç¨¿åŠŸèƒ½éƒ¨ç½²æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

æ–°å¢äº†å®Œæ•´çš„è‰ç¨¿ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- âœ… ä¿å­˜è‰ç¨¿åˆ°æœåŠ¡å™¨ï¼ˆæ›¿ä»£åŸæœ‰çš„ localStorage æ–¹æ¡ˆï¼‰
- âœ… æŸ¥çœ‹æ‰€æœ‰è‰ç¨¿åˆ—è¡¨
- âœ… åŠ è½½è‰ç¨¿ç»§ç»­ç¼–è¾‘
- âœ… åˆ é™¤è‰ç¨¿
- âœ… ä»è‰ç¨¿å‘å¸ƒä¸ºæ­£å¼æ–‡ç« 
- âœ… è‰ç¨¿å’Œå·²å‘å¸ƒæ–‡ç« åˆ†å¼€å±•ç¤º
- âœ… å¿«æ·é”® Cmd/Ctrl+S ä¿å­˜è‰ç¨¿

## åç«¯æ›´æ”¹

### 1. æ•°æ®åº“æ¨¡å‹ï¼ˆPrisma Schemaï¼‰

åœ¨ `backend/prisma/schema.prisma` ä¸­æ–°å¢äº† `Draft` æ¨¡å‹ï¼š

```prisma
model Draft {
  id            String   @id @default(uuid())
  title         String
  summary       String
  content       String   @db.Text
  publishDate   DateTime
  tags          String[]
  readTime      Int
  coverImage    String?
  link          String?
  type          String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
```

### 2. API è·¯ç”±

æ–°å¢ `backend/routes/drafts.js`ï¼Œæä¾›å®Œæ•´çš„ CRUD æ“ä½œï¼š

- `GET /api/drafts` - è·å–æ‰€æœ‰è‰ç¨¿
- `GET /api/drafts/:id` - è·å–å•ä¸ªè‰ç¨¿
- `POST /api/drafts` - åˆ›å»ºæ–°è‰ç¨¿
- `PUT /api/drafts/:id` - æ›´æ–°è‰ç¨¿
- `DELETE /api/drafts/:id` - åˆ é™¤è‰ç¨¿

### 3. æœåŠ¡å™¨é…ç½®

åœ¨ `backend/index.js` ä¸­æ³¨å†Œäº†è‰ç¨¿è·¯ç”±ã€‚

## å‰ç«¯æ›´æ”¹

### 1. API å®¢æˆ·ç«¯

åœ¨ `frontend/src/shared/utils/backendClient.ts` ä¸­æ–°å¢ï¼š

- `Draft` ç±»å‹å®šä¹‰
- `CreateDraftRequest` ç±»å‹å®šä¹‰
- `fetchDrafts()` - è·å–è‰ç¨¿åˆ—è¡¨
- `fetchDraftById()` - è·å–å•ä¸ªè‰ç¨¿
- `createDraft()` - åˆ›å»ºè‰ç¨¿
- `updateDraft()` - æ›´æ–°è‰ç¨¿
- `deleteDraft()` - åˆ é™¤è‰ç¨¿

### 2. ç¼–è¾‘å™¨é¡µé¢

åœ¨ `ArticleEditorPage.tsx` ä¸­çš„ä¸»è¦æ›´æ”¹ï¼š

#### æ–°å¢çŠ¶æ€ç®¡ç†
```typescript
const [drafts, setDrafts] = useState<Draft[]>([]);
const [currentDraftId, setCurrentDraftId] = useState<string | undefined>(undefined);
const [isDraftMode, setIsDraftMode] = useState(false);
```

#### æ ¸å¿ƒåŠŸèƒ½
1. **ä¿å­˜è‰ç¨¿** - `handleSaveDraft()` ä¿å­˜åˆ°æœåŠ¡å™¨
2. **åŠ è½½è‰ç¨¿** - `handleLoadDraft()` åŠ è½½è‰ç¨¿åˆ°ç¼–è¾‘å™¨
3. **åˆ é™¤è‰ç¨¿** - `handleDeleteDraft()` åˆ é™¤è‰ç¨¿
4. **å‘å¸ƒæ–‡ç« ** - ä»è‰ç¨¿å‘å¸ƒåè‡ªåŠ¨åˆ é™¤è‰ç¨¿

#### UI æ›´æ–°
- é¡¶éƒ¨æ–°å¢"è‰ç¨¿"æ ‡ç­¾æ˜¾ç¤ºå½“å‰çŠ¶æ€
- å·¥å…·æ æ–°å¢"ä¿å­˜è‰ç¨¿"æŒ‰é’®ï¼ˆä»…åœ¨éç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºï¼‰
- å·¦ä¾§å†å²æŠ½å±‰åˆ†ä¸º"è‰ç¨¿"å’Œ"å·²å‘å¸ƒæ–‡ç« "ä¸¤ä¸ªåŒºåŸŸ
- è‰ç¨¿åˆ—è¡¨æ˜¾ç¤ºæ›´æ–°æ—¶é—´ï¼Œå·²å‘å¸ƒæ–‡ç« æ˜¾ç¤ºå‘å¸ƒæ—¥æœŸ

## éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»

åœ¨éƒ¨ç½²æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cd backend
npx prisma migrate deploy
```

æˆ–è€…åœ¨å¼€å‘ç¯å¢ƒï¼š

```bash
cd backend
npx prisma migrate dev --name add_draft_model
```

### 2. é‡æ–°ç”Ÿæˆ Prisma Client

```bash
cd backend
npx prisma generate
```

### 3. é‡å¯åç«¯æœåŠ¡

```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 restart backend

# æˆ–è€…ä½¿ç”¨ Docker
docker-compose restart backend

# æˆ–è€…æ‰‹åŠ¨é‡å¯
cd backend
npm start
```

### 4. é‡æ–°æ„å»ºå‰ç«¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
cd frontend
npm run build
```

### 5. éªŒè¯éƒ¨ç½²

1. è®¿é—®ç¼–è¾‘å™¨é¡µé¢
2. åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« 
3. ç‚¹å‡»"ä¿å­˜è‰ç¨¿"æŒ‰é’®æˆ–ä½¿ç”¨ Cmd/Ctrl+S
4. æ£€æŸ¥å·¦ä¾§å†å²æŠ½å±‰ä¸­æ˜¯å¦æ˜¾ç¤ºè‰ç¨¿
5. ç‚¹å‡»è‰ç¨¿åç§°ç¡®è®¤å¯ä»¥åŠ è½½
6. ä»è‰ç¨¿å‘å¸ƒæ–‡ç« ï¼Œç¡®è®¤è‰ç¨¿è¢«è‡ªåŠ¨åˆ é™¤

## ä½¿ç”¨è¯´æ˜

### ä¿å­˜è‰ç¨¿

1. **æ‰‹åŠ¨ä¿å­˜**ï¼šç‚¹å‡»å·¥å…·æ çš„"ä¿å­˜è‰ç¨¿"æŒ‰é’®
2. **å¿«æ·é”®**ï¼šæŒ‰ `Cmd+S` (Mac) æˆ– `Ctrl+S` (Windows/Linux)

### åŠ è½½è‰ç¨¿

1. ç‚¹å‡»é¡¶éƒ¨å·¥å…·æ çš„å†å²æŒ‰é’®
2. åœ¨å·¦ä¾§æŠ½å±‰çš„"è‰ç¨¿"åŒºåŸŸæ‰¾åˆ°è¦ç¼–è¾‘çš„è‰ç¨¿
3. ç‚¹å‡»è‰ç¨¿åç§°å³å¯åŠ è½½åˆ°ç¼–è¾‘å™¨

### å‘å¸ƒè‰ç¨¿

1. åŠ è½½è‰ç¨¿åç»§ç»­ç¼–è¾‘
2. ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®
3. è‰ç¨¿å°†è¢«å‘å¸ƒä¸ºæ­£å¼æ–‡ç« ï¼Œå¹¶è‡ªåŠ¨åˆ é™¤è‰ç¨¿

### åˆ é™¤è‰ç¨¿

1. åœ¨è‰ç¨¿åˆ—è¡¨ä¸­æ‰¾åˆ°è¦åˆ é™¤çš„è‰ç¨¿
2. ç‚¹å‡»è‰ç¨¿å³ä¾§çš„åˆ é™¤å›¾æ ‡
3. ç¡®è®¤åˆ é™¤æ“ä½œ

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®è¿ç§»**ï¼šåŸæœ‰çš„ localStorage è‰ç¨¿æ•°æ®ä¸ä¼šè‡ªåŠ¨è¿ç§»åˆ°æœåŠ¡å™¨ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨å¤„ç†
2. **æƒé™éªŒè¯**ï¼šè‰ç¨¿åŠŸèƒ½ç»§æ‰¿ç¼–è¾‘å™¨çš„å¯†ç éªŒè¯æœºåˆ¶
3. **è‡ªåŠ¨ä¿å­˜**ï¼šç›®å‰ä»…æ”¯æŒæ‰‹åŠ¨ä¿å­˜å’Œå¿«æ·é”®ä¿å­˜ï¼Œæœªæ¥å¯ä»¥æ·»åŠ è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
4. **è‰ç¨¿æ’åº**ï¼šè‰ç¨¿æŒ‰æ›´æ–°æ—¶é—´å€’åºæ’åˆ—ï¼Œæœ€æ–°ç¼–è¾‘çš„åœ¨æœ€ä¸Šé¢

## åç»­ä¼˜åŒ–å»ºè®®

1. **è‡ªåŠ¨ä¿å­˜**ï¼šæ¯éš”ä¸€å®šæ—¶é—´è‡ªåŠ¨ä¿å­˜è‰ç¨¿
2. **ç‰ˆæœ¬å†å²**ï¼šä¿å­˜è‰ç¨¿çš„å¤šä¸ªç‰ˆæœ¬ï¼Œæ”¯æŒå›é€€
3. **è‰ç¨¿æœç´¢**ï¼šåœ¨è‰ç¨¿åˆ—è¡¨ä¸­æ·»åŠ æœç´¢åŠŸèƒ½
4. **è‰ç¨¿é¢„è§ˆ**ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºè‰ç¨¿å†…å®¹é¢„è§ˆ
5. **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡åˆ é™¤è‰ç¨¿
6. **æ•°æ®è¿ç§»å·¥å…·**ï¼šæä¾›å·¥å…·å°† localStorage è‰ç¨¿è¿ç§»åˆ°æœåŠ¡å™¨

## é—®é¢˜æ’æŸ¥

### è‰ç¨¿ä¿å­˜å¤±è´¥

1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’Œåç«¯æ—¥å¿—

### è‰ç¨¿åˆ—è¡¨ä¸æ˜¾ç¤º

1. æ£€æŸ¥ API è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆæµè§ˆå™¨ Network é¢æ¿ï¼‰
2. ç¡®è®¤æ•°æ®åº“ä¸­æ˜¯å¦æœ‰è‰ç¨¿æ•°æ®
3. æ£€æŸ¥å‰ç«¯çŠ¶æ€ç®¡ç†æ˜¯å¦æ­£ç¡®

### è‰ç¨¿åˆ é™¤å¤±è´¥

1. ç¡®è®¤è‰ç¨¿ ID æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥åç«¯åˆ é™¤ API æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. æŸ¥çœ‹åç«¯æ—¥å¿—ç¡®è®¤é”™è¯¯ä¿¡æ¯

## æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js + Express + Prisma
- **æ•°æ®åº“**: PostgreSQL
- **å‰ç«¯**: React + TypeScript
- **çŠ¶æ€ç®¡ç†**: React Hooks (useState, useEffect)
- **UI ç»„ä»¶**: @suminhan/land-design

---

éƒ¨ç½²å®Œæˆåï¼Œè‰ç¨¿åŠŸèƒ½å°†å®Œå…¨å¯ç”¨ï¼ğŸ‰
